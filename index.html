<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BR6G525NDG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-BR6G525NDG');
</script>
<title>ì›¨ë”©ì •ë³´ë§µ - ê³µê³µë°ì´í„° ì—°ë™</title>

<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ee4ca5b694129145f0819786d73d107a&libraries=services&autoload=false"></script>

<style>
body { margin: 0; font-family: "Noto Sans KR", Arial, sans-serif; background: #fafafa; }
h1 { text-align: center; margin: 18px 0 10px; font-size: 22px; }

/* ê²€ìƒ‰ ë° í•„í„° ë°” */
#searchBar { display: flex; justify-content: center; gap: 8px; margin-bottom: 10px; }
#searchBar input { width: 220px; padding: 9px 14px; border-radius: 20px; border: 1px solid #ddd; }
#searchBar button { padding: 9px 16px; border-radius: 20px; border: none; background: #f0b6c9; color: #fff; cursor: pointer; }

#filterBar { display: flex; justify-content: center; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; }
#filterBar button { padding: 8px 16px; border-radius: 20px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
#filterBar button.active { background: #f0b6c9; color: #fff; border-color: #f0b6c9; }

/* ë ˆì´ì•„ì›ƒ */
#contentWrap { display: flex; justify-content: center; gap: 16px; padding: 0 16px 30px; }
#map { width: 55%; height: 520px; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); }
#sideWrap { width: 45%; max-width: 420px; display: flex; flex-direction: column; gap: 12px; }

/* ë¦¬ìŠ¤íŠ¸ ë° ìƒì„¸ íŒ¨ë„ */
#list { background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.12); overflow-y: auto; max-height: 300px; }
.list-item { display: flex; gap: 12px; padding: 14px; cursor: pointer; border-bottom: 1px solid #f1f1f1; }
.list-item:hover { background: #fff5f8; }
.list-thumb { width: 56px; height: 56px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 26px; color: #fff; }
.thumb-ì›¨ë”©í™€ { background: #f0b6c9; }
.thumb-ìŠ¤íŠœë””ì˜¤ { background: #7ab8f5; }
.thumb-ë“œë ˆìŠ¤ { background: #c8a2e8; }
.thumb-ë©”ì´í¬ì—… { background: #f5b27a; }
.list-meta { font-size: 12px; color: #777; }

#detailPanel { background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); padding: 18px; display: none; }
#detailPanel h2 { margin: 0 0 6px; }
.tag { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; margin-bottom: 8px; }
.tag-ì›¨ë”©í™€ { background:#ffe6ee; color:#c94a6a; }
#detailPanel button { width: 100%; margin-top: 14px; padding: 12px; border-radius: 14px; border: none; background: #f0b6c9; color: #fff; font-size: 15px; cursor: pointer; }
</style>
</head>

<body>

<h1>ğŸ’ ì›¨ë”©ì •ë³´ë§µ</h1>

<div id="searchBar">
  <input id="keyword" placeholder="ì§€ì—­ ê²€ìƒ‰ (ì˜ˆ: ê°•ë‚¨, í™ëŒ€)" />
  <button onclick="searchPlace()">ê²€ìƒ‰</button>
</div>

<div id="filterBar">
  <button class="active" onclick="filterMarkers('ì „ì²´')">ì „ì²´</button>
  <button onclick="filterMarkers('ì›¨ë”©í™€')">ì›¨ë”©í™€</button>
  <button onclick="filterMarkers('ìŠ¤íŠœë””ì˜¤')">ìŠ¤íŠœë””ì˜¤</button>
  <button onclick="filterMarkers('ë“œë ˆìŠ¤')">ë“œë ˆìŠ¤</button>
  <button onclick="filterMarkers('ë©”ì´í¬ì—…')">ë©”ì´í¬ì—…</button>
</div>

<div id="contentWrap">
  <div id="map"></div>
  <div id="sideWrap">
    <div id="list"></div>
    <div id="detailPanel"></div>
  </div>
</div>

<script>
let map;
let ps;
let allWeddingData = []; // ê³µê³µë°ì´í„° ì €ì¥ìš©
let markers = []; // ì§€ë„ ë§ˆì»¤ ì €ì¥ìš©

// ì¹´ì¹´ì˜¤ SDK ë¡œë“œ ëŒ€ê¸°
kakao.maps.load(function() {
    const container = document.getElementById('map');
    const options = {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 8
    };
    map = new kakao.maps.Map(container, options);
    ps = new kakao.maps.services.Places();

    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œì‘
    fetchPublicData();
});

// ê³µê³µë°ì´í„° API í˜¸ì¶œ í•¨ìˆ˜
async function fetchPublicData() {
    const serviceKey = 'd030c12012702d15b0490241512870f35c111e91ccac18cddd3e23e0173e06d2'; 
    const url = `https://api.data.go.kr/openapi/tn_pubr_public_wedding_and_ceremony_hall_api?serviceKey=${serviceKey}&type=json&numOfRows=100`;

    try {
        const response = await fetch(url);
        const json = await response.json();
        const items = json.response.body.items;

        // ê³µê³µë°ì´í„°ë¥¼ ì•± í˜•ì‹ì— ë§ê²Œ ë³€í™˜
        allWeddingData = items.map(item => ({
            name: item.insttNm,
            type: "ì›¨ë”©í™€",
            icon: "ğŸ’’",
            lat: parseFloat(item.latitude),
            lng: parseFloat(item.longitude),
            address: item.rdnmadr || item.lnmadr,
            rating: (Math.random() * (5.0 - 4.2) + 4.2).toFixed(1) // ì„ì‹œ ë³„ì 
        })).filter(item => !isNaN(item.lat));

        renderList('ì „ì²´');
        displayMarkers('ì „ì²´');
    } catch (error) {
        console.error("ë°ì´í„° ë¡œë“œ ì—ëŸ¬:", error);
    }
}

// ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
function displayMarkers(type) {
    markers.forEach(m => m.setMap(null));
    markers = [];

    allWeddingData.forEach(p => {
        if (type === 'ì „ì²´' || p.type === type) {
            const marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(p.lat, p.lng)
            });

            kakao.maps.event.addListener(marker, 'click', () => openDetail(p));
            markers.push(marker);
        }
    });
}

// ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
function renderList(type) {
    const listDiv = document.getElementById('list');
    listDiv.innerHTML = "";

    allWeddingData.forEach(p => {
        if (type === 'ì „ì²´' || p.type === type) {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <div class="list-thumb thumb-${p.type}">${p.icon}</div>
                <div>
                    <b>${p.name}</b>
                    <div class="list-meta">${p.type} Â· â­ ${p.rating}</div>
                </div>
            `;
            div.onclick = () => openDetail(p);
            listDiv.appendChild(div);
        }
    });
}

// ìƒì„¸ ì •ë³´ ì—´ê¸°
function openDetail(p) {
    map.panTo(new kakao.maps.LatLng(p.lat, p.lng));
    map.setLevel(4);

    const panel = document.getElementById('detailPanel');
    panel.style.display = 'block';
    panel.innerHTML = `
        <h2>${p.name}</h2>
        <span class="tag tag-${p.type}">${p.type}</span>
        <p style="margin-top:10px; font-size:14px; color:#555;">ğŸ“ ${p.address}</p>
        <p>â­ ${p.rating}</p>
        <button onclick="alert('ë¬¸ì˜ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')">ìƒë‹´ ë¬¸ì˜í•˜ê¸°</button>
    `;
}

// í•„í„° ë³€ê²½
function filterMarkers(type) {
    document.querySelectorAll('#filterBar button').forEach(b =>
        b.classList.toggle('active', b.innerText === type)
    );
    displayMarkers(type);
    renderList(type);
    document.getElementById('detailPanel').style.display = 'none';
}

// ì§€ì—­ ê²€ìƒ‰
function searchPlace() {
    const keyword = document.getElementById('keyword').value;
    if (!keyword) return;
    ps.keywordSearch(keyword, (data, status) => {
        if (status === kakao.maps.services.Status.OK) {
            map.setCenter(new kakao.maps.LatLng(data[0].y, data[0].x));
            map.setLevel(7);
        }
    });
}
</script>

</body>
</html>