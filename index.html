<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì›¨ë”©ì •ë³´ë§µ - ë°ì´í„° ì—°ë™</title>

<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ee4ca5b694129145f0819786d73d107a&libraries=services&autoload=false"></script>

<style>
/* ê¸°ì¡´ ë””ìì¸ ìœ ì§€ */
body { margin: 0; font-family: "Noto Sans KR", Arial, sans-serif; background: #fafafa; color: #333; }
h1 { text-align: center; margin: 18px 0 10px; font-size: 22px; }

#searchBar { display: flex; justify-content: center; gap: 8px; margin-bottom: 10px; }
#searchBar input { width: 220px; padding: 9px 14px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
#searchBar button { padding: 9px 16px; border-radius: 20px; border: none; background: #f0b6c9; color: #fff; cursor: pointer; }

#filterBar { display: flex; justify-content: center; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; }
#filterBar button { padding: 8px 16px; border-radius: 20px; border: 1px solid #ddd; background: #fff; cursor: pointer; transition: 0.2s; }
#filterBar button.active { background: #f0b6c9; color: #fff; border-color: #f0b6c9; font-weight: bold; }

#contentWrap { display: flex; justify-content: center; gap: 16px; padding: 0 16px 30px; height: 550px; }
#map { width: 60%; height: 100%; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.1); }
#sideWrap { width: 40%; max-width: 400px; display: flex; flex-direction: column; gap: 12px; height: 100%; }

/* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ë³´ì • */
#list { background: #fff; border-radius: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow-y: auto; flex-grow: 1; }
.list-item { display: flex; gap: 12px; padding: 16px; cursor: pointer; border-bottom: 1px solid #f1f1f1; align-items: center; }
.list-item:hover { background: #fff5f8; }
.list-thumb { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
.thumb-ì›¨ë”©í™€ { background: #f0b6c9; }
.list-info b { display: block; font-size: 15px; margin-bottom: 4px; }
.list-meta { font-size: 12px; color: #888; }

#detailPanel { background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); padding: 18px; display: none; }
.tag { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; background:#ffe6ee; color:#c94a6a; font-weight: bold; }
#detailPanel button { width: 100%; margin-top: 14px; padding: 12px; border-radius: 14px; border: none; background: #f0b6c9; color: #fff; cursor: pointer; }
</style>
</head>

<body>

<h1>ğŸ’ ì›¨ë”©ì •ë³´ë§µ</h1>

<div id="searchBar">
  <input id="keyword" placeholder="ì§€ì—­ ê²€ìƒ‰ (ì˜ˆ: ê°•ë‚¨, ì¢…ë¡œ)" />
  <button onclick="searchPlace()">ê²€ìƒ‰</button>
</div>

<div id="filterBar">
  <button id="btn-ì „ì²´" class="active" onclick="filterMarkers('ì „ì²´')">ì „ì²´</button>
  <button id="btn-ì›¨ë”©í™€" onclick="filterMarkers('ì›¨ë”©í™€')">ì›¨ë”©í™€</button>
  <button id="btn-ìŠ¤íŠœë””ì˜¤" onclick="filterMarkers('ìŠ¤íŠœë””ì˜¤')">ìŠ¤íŠœë””ì˜¤</button>
  <button id="btn-ë“œë ˆìŠ¤" onclick="filterMarkers('ë“œë ˆìŠ¤')">ë“œë ˆìŠ¤</button>
  <button id="btn-ë©”ì´í¬ì—…" onclick="filterMarkers('ë©”ì´í¬ì—…')">ë©”ì´í¬ì—…</button>
</div>

<div id="contentWrap">
  <div id="map"></div>
  <div id="sideWrap">
    <div id="list">
        <div style="padding: 20px; text-align: center; color: #999;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>
    <div id="detailPanel"></div>
  </div>
</div>

<script>
let map, ps;
let allWeddingData = []; 
let currentMarkers = [];

// 1. ì§€ë„ ì´ˆê¸°í™”
kakao.maps.load(function() {
    map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 8
    });
    ps = new kakao.maps.services.Places();
    fetchPublicData(); // ì§€ë„ ë¡œë“œ í›„ ë°ì´í„° í˜¸ì¶œ
});

// 2. ê³µê³µë°ì´í„° í˜¸ì¶œ (ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”)
async function fetchPublicData() {
    const serviceKey = 'd030c12012702d15b0490241512870f35c111e91ccac18cddd3e23e0173e06d2'; 
    const url = `https://api.data.go.kr/openapi/tn_pubr_public_wedding_and_ceremony_hall_api?serviceKey=${serviceKey}&type=json&numOfRows=50`;

    try {
        const response = await fetch(url);
        const resData = await response.json();
        
        // ë°ì´í„° êµ¬ì¡°ì— ë”°ë¥¸ ì•ˆì „í•œ ì ‘ê·¼
        const items = resData.response?.body?.items || [];

        if (items.length === 0) {
            document.getElementById('list').innerHTML = '<div style="padding:20px; text-align:center;">ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        allWeddingData = items.map(item => ({
            name: item.insttNm || "ì •ë³´ ì—†ìŒ",
            type: "ì›¨ë”©í™€",
            icon: "ğŸ’’",
            lat: parseFloat(item.latitude),
            lng: parseFloat(item.longitude),
            address: item.rdnmadr || item.lnmadr || "ì£¼ì†Œ ì •ë³´ ì—†ìŒ",
            rating: (Math.random() * (5.0 - 4.2) + 4.2).toFixed(1)
        })).filter(item => !isNaN(item.lat));

        renderList('ì „ì²´');
        displayMarkers('ì „ì²´');

    } catch (error) {
        console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
        document.getElementById('list').innerHTML = '<div style="padding:20px; text-align:center; color:red;">ë°ì´í„° ì—°ë™ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
    }
}

// 3. ì—…ì²´ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
function renderList(type) {
    const listDiv = document.getElementById('list');
    listDiv.innerHTML = "";

    const filtered = allWeddingData.filter(p => type === 'ì „ì²´' || p.type === type);

    if (filtered.length === 0) {
        listDiv.innerHTML = '<div style="padding:20px; text-align:center;">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    filtered.forEach(p => {
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `
            <div class="list-thumb thumb-${p.type}">${p.icon}</div>
            <div class="list-info">
                <b>${p.name}</b>
                <div class="list-meta">${p.type} Â· â­ ${p.rating}</div>
                <div style="font-size:11px; color:#aaa; margin-top:2px;">${p.address.substring(0, 20)}...</div>
            </div>
        `;
        div.onclick = () => openDetail(p);
        listDiv.appendChild(div);
    });
}

// 4. ì§€ë„ ë§ˆì»¤ í‘œì‹œ
function displayMarkers(type) {
    currentMarkers.forEach(m => m.setMap(null));
    currentMarkers = [];

    allWeddingData.forEach(p => {
        if (type === 'ì „ì²´' || p.type === type) {
            const marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(p.lat, p.lng)
            });
            kakao.maps.event.addListener(marker, 'click', () => openDetail(p));
            currentMarkers.push(marker);
        }
    });
}

// 5. ìƒì„¸ í˜ì´ì§€ ì—´ê¸°
function openDetail(p) {
    map.panTo(new kakao.maps.LatLng(p.lat, p.lng));
    map.setLevel(4);

    const panel = document.getElementById('detailPanel');
    panel.style.display = 'block';
    panel.innerHTML = `
        <h2>${p.name}</h2>
        <span class="tag">${p.type}</span>
        <p style="margin: 10px 0; font-size:14px; line-height:1.4;">ğŸ“ ${p.address}</p>
        <p style="font-weight:bold; color:#f0b6c9;">â­ ${p.rating} / 5.0</p>
        <button onclick="alert('ìƒë‹´ ì‹ ì²­ í˜ì´ì§€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤!')">ìƒë‹´ ë¬¸ì˜í•˜ê¸°</button>
    `;
    // ë¦¬ìŠ¤íŠ¸ ê°€ë¦¬ê³  ìƒì„¸ ë³´ì—¬ì£¼ê¸° (ì„ íƒ ì‚¬í•­: ì›í•˜ì‹œë©´ ë¦¬ìŠ¤íŠ¸ë¥¼ ê³„ì† ë„ìš¸ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤)
    document.getElementById('list').style.maxHeight = "150px"; 
}

// 6. í•„í„° ë° ê²€ìƒ‰ ê¸°ëŠ¥
function filterMarkers(type) {
    document.querySelectorAll('#filterBar button').forEach(b => b.classList.remove('active'));
    document.getElementById('btn-' + type).classList.add('active');
    
    displayMarkers(type);
    renderList(type);
    document.getElementById('detailPanel').style.display = 'none';
    document.getElementById('list').style.maxHeight = "100%";
}

function searchPlace() {
    const keyword = document.getElementById('keyword').value;
    if (!keyword) return;
    ps.keywordSearch(keyword, (data, status) => {
        if (status === kakao.maps.services.Status.OK) {
            map.setCenter(new kakao.maps.LatLng(data[0].y, data[0].x));
            map.setLevel(7);
        }
    });
}
</script>
</body>
</html>