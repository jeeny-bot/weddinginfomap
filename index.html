<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì›¨ë”©ì •ë³´ë§µ MVP (ìŠ¤ë“œë©”)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- âœ… Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BR6G525NDG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-BR6G525NDG');
</script>

<!-- âœ… Kakao Map -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ee4ca5b694129145f0819786d73d107a&libraries=services"></script>

<style>
/* ===== ë””ìì¸ ì ˆëŒ€ ë³€ê²½ ì—†ìŒ ===== */
body { margin:0; font-family:"Noto Sans KR", Arial, sans-serif; background:#fafafa; }
h1 { text-align:center; margin:16px 0 10px; font-size:22px; }
#searchBar { display:flex; justify-content:center; gap:8px; margin-bottom:10px; }
#searchBar input { width:220px; padding:9px 14px; border-radius:20px; border:1px solid #ddd; }
#searchBar button { padding:9px 16px; border-radius:20px; border:none; background:#f0b6c9; color:#fff; cursor:pointer; }

#filterBar { display:flex; justify-content:center; gap:8px; margin-bottom:14px; flex-wrap:wrap; }
#filterBar button { padding:8px 16px; border-radius:20px; border:1px solid #ddd; background:#fff; cursor:pointer; }
#filterBar button.active { background:#f0b6c9; color:#fff; border-color:#f0b6c9; }

#contentWrap { display:flex; justify-content:center; gap:16px; padding:0 16px 30px; }
#map { width:55%; height:520px; border-radius:16px; box-shadow:0 6px 18px rgba(0,0,0,0.15); }
#sideWrap { width:45%; max-width:420px; display:flex; flex-direction:column; gap:12px; }

#list, #detailPanel { background:#fff; border-radius:16px; box-shadow:0 6px 18px rgba(0,0,0,0.12); }
#list { overflow-y:auto; max-height:300px; }

.list-item { display:flex; gap:12px; padding:14px; border-bottom:1px solid #eee; cursor:pointer; }
.list-item:hover { background:#fff3f7; }
.list-thumb { width:56px; height:56px; border-radius:10px; background:#ddd; }
.list-meta { font-size:12px; color:#777; }

#detailPanel { padding:16px; display:none; }
#detailPanel h2 { margin:0 0 6px; }
#detailPanel button { width:100%; margin-top:12px; padding:12px; border-radius:12px; border:none; background:#f0b6c9; color:#fff; font-size:15px; cursor:pointer; }
</style>
</head>

<body>

<h1>ğŸ’ ì›¨ë”©ì •ë³´ë§µ (ìŠ¤ë“œë©”)</h1>

<div id="searchBar">
  <input id="keyword" placeholder="ì§€ì—­ ê²€ìƒ‰ (ì˜ˆ: ê°•ë‚¨, ì¢…ë¡œ)" />
  <button onclick="searchPlace()">ê²€ìƒ‰</button>
</div>

<div id="filterBar">
  <button class="active">ì „ì²´</button>
  <button>ì›¨ë”©í™€</button>
  <button>ìŠ¤íŠœë””ì˜¤</button>
  <button>ë“œë ˆìŠ¤</button>
  <button>ë©”ì´í¬ì—…</button>
</div>

<div id="contentWrap">
  <div id="map"></div>
  <div id="sideWrap">
    <div id="list"></div>
    <div id="detailPanel"></div>
  </div>
</div>

<script>
/* ===== ì§€ë„ ê¸°ë³¸ ===== */
const map = new kakao.maps.Map(document.getElementById('map'), {
  center: new kakao.maps.LatLng(37.5665, 126.9780),
  level: 7
});
const geocoder = new kakao.maps.services.Geocoder();
const ps = new kakao.maps.services.Places();

let markers = [];
let weddingHalls = [];

/* ===== ê³µê³µë°ì´í„° API ===== */
const SERVICE_KEY = "d03c12012702d15b0490241512870f35c111e91ccac18cddd3e23e0173e06d2";
const API_URL = `https://api.data.go.kr/openapi/tn_pubr_public_wedding_and_ceremony_hall_api?serviceKey=${SERVICE_KEY}&pageNo=1&numOfRows=50&type=json`;

/* ===== ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ===== */
fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    const items = data.response.body.items;
    items.forEach(item => addWeddingHall(item));
  })
  .catch(() => {
    document.getElementById("list").innerHTML =
      "<p style='padding:16px;color:red'>ë°ì´í„° ì—°ë™ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
  });

function addWeddingHall(item) {
  const name = item.fcltyNm;
  const address = item.rdnmadr || item.lnmadr;
  if (!address) return;

  geocoder.addressSearch(address, (result, status) => {
    if (status !== kakao.maps.services.Status.OK) return;

    const hall = {
      name,
      address,
      lat: result[0].y,
      lng: result[0].x
    };

    weddingHalls.push(hall);
    createMarker(hall);
    createListItem(hall);
  });
}

/* ===== ë§ˆì»¤ ===== */
function createMarker(p) {
  const marker = new kakao.maps.Marker({
    map,
    position: new kakao.maps.LatLng(p.lat, p.lng)
  });
  markers.push(marker);
  kakao.maps.event.addListener(marker, 'click', () => openDetail(p));
}

/* ===== ë¦¬ìŠ¤íŠ¸ ===== */
function createListItem(p) {
  const list = document.getElementById("list");
  const div = document.createElement("div");
  div.className = "list-item";
  div.innerHTML = `
    <div class="list-thumb"></div>
    <div>
      <b>${p.name}</b>
      <div class="list-meta">${p.address}</div>
    </div>
  `;
  div.onclick = () => openDetail(p);
  list.appendChild(div);
}

/* ===== ìƒì„¸ ===== */
function openDetail(p) {
  map.setLevel(4);
  map.panTo(new kakao.maps.LatLng(p.lat, p.lng));

  const panel = document.getElementById("detailPanel");
  panel.style.display = "block";
  panel.innerHTML = `
    <h2>${p.name}</h2>
    <p>${p.address}</p>
    <button>ìƒë‹´ ë¬¸ì˜í•˜ê¸°</button>
  `;
}

/* ===== ê²€ìƒ‰ ===== */
function searchPlace() {
  const keyword = document.getElementById("keyword").value;
  if (!keyword) return;

  ps.keywordSearch(keyword, (data, status) => {
    if (status === kakao.maps.services.Status.OK) {
      map.setCenter(new kakao.maps.LatLng(data[0].y, data[0].x));
      map.setLevel(6);
    }
  });
}
</script>

</body>
</html>
